\section{Graphentheorie}
\paragraph{Gradmatrix}
Die Gradmatrix $D_\mathcal{G}$ enthält auf der Hauptdiagonalen den Eingangsgrad des jeweiligen Knotens.

\paragraph{Adjazenzmatrix}
Die Adjazenzmatrix $A_\mathcal{G}$ enthält im Element $a_{ij}$
das Kantengewicht der Kante $(j \rightarrow i)$.

\paragraph{Laplacematrix}
\begin{equation}
    \tag{Laplacematrix}
    L_\mathcal{G} = D_\mathcal{G} - A_\mathcal{G}
    \label{eqn:laplace_matrix}
\end{equation}
Die Laplacematrix berechnet sich aus Gradmatrix $D$ und
Adjazentmatrix $A$.

\section{Leader-Follower Zustandssynchronisierung}
\paragraph{Leader-Follower-Matrix}
\label{par:leader_follower_matrix}
\begin{equation}
    \tag{Leader-Follower-Matrix}
    H = L_\mathcal{G} + L_0 \in \mathbb{R}^{N\times N}
    \label{eqn:lf_matrix}
\end{equation}
$L_0$ ist dabei die Diagonalmatrix mit $L_{0,ii}=a_{i0}$.

Es gilt $\det(H) \neq 0$ und $\operatorname{Re}\lambda_i(H) > 0$,
wenn der erweiterte Graph einen Spannbaum mit dem Führungsagenten als
Wurzel besitzt.

\subsection{Folgefehler}
Der Folgefehler ist definiert als:
\begin{equation}
    \varepsilon = \begin{bmatrix}
        x_1-x_0 \\
        \vdots \\
        x_N-x_0
    \end{bmatrix}
    = x-1_N \otimes x_0
\end{equation}
wobei $x_i$ der Zustandsvektor des Agenten $i$ ist.
Mit ein bisschen einsetzen von $\dot{x} = (I_N \otimes A)x + (I_N \otimes B)u$
und Umformen kommt man daraus auf die \emph{Folgefehlerdynamik}
\begin{equation}
    \dot{\varepsilon} = (I_N \otimes A)\varepsilon + (I_N \otimes B)u
\end{equation}

Mit einem Regler $u=-(I_N \otimes K)\varepsilon$  ergibt sich das
\emph{geregelte Folgefehlersystem}
\begin{equation}
    \dot{\varepsilon} = (I_N \otimes (A-BK))\varepsilon
\end{equation}

Aufgabe ist jetzt $K$ so zu bestimmen dass das geregelte Fehlersystem unseren
Anforderungen (exponentielle Stabilität) entspricht.

Dies beachtet allerdings noch nicht die Netzwerktopologie.
Das macht im nächsten Abschnitt die

\subsection{Diffusive Kopplung}
Im Hinblick auf die Netzwerktopologie findet sich der Folgefehler in der
diffusiven Kopplung wieder:

\begin{align}
    \bar{u}_i &= \sum_{j=1}^N a_{ij} (x_i-x_j) + a_{i0}(x_ix_0) \\
    &= \sum_{j=1}^N a_{ij} (\varepsilon_i - \varepsilon_j) + a_{i0} \varepsilon_i \\
    &= \left(e_i^T\underbrace{(L_G+L_0)}_H \otimes I_n\right)\varepsilon
\end{align}
Wobei $e_i^T$ ein Zeilenvektor ist mit $1$ an Stelle $i$, sonst $0$.

Aggregieren der $\bar{u}_i$ Elemente ergibt
\begin{equation}
    \bar{u} = (H \otimes I_n)\varepsilon
\end{equation}

\subsection{Fehlersystem mit diffusiver Kopplung}
Nun lässt sich eine Rückführung definieren:
\begin{equation}
    u=-\tilde{K}(H\otimes I_n)\varepsilon
\end{equation}
wobei $\tilde{K}$ eine Blockmatrix ist mit den Rückführmatrizen $K_i$ der einzelnen
Agenten auf der Hauptdiagonalen.

Das geregelte Fehlersystem ist nun
\begin{equation}
    \dot{\varepsilon} = (I_N \otimes A - (I_N \otimes B) \tilde{K}(H \otimes I_n))\varepsilon
    \label{eqn:fehlersystem_geregelt_ktilde}
\end{equation}

\subsection{Simultanes Stabilisierungsproblem}
Im folgenden wird für jeden Folgeagenten die Gleiche Rückführmatrix $K$ verwendet.
Das bedeutet, dass diese Matrix \emph{simultan} jeden Folgeagenten stabilisieren
muss:
\begin{equation}
    \tilde{K}=I_N \otimes K
\end{equation}
Das Stellgesetz lautet nun
\begin{equation}
    u=-(I_N \otimes K) (H \otimes I_n)\varepsilon = -(H \otimes K)\varepsilon
\end{equation}

Mit dem Ziel, die leader-follower Matrix $H$ auf Schursche Normalform zu bringen,
wird die Transformation
\begin{align}
    \tilde{\varepsilon} &= (T^H \otimes I_n)\epsilon \\
    \varepsilon &= (T \otimes I_n)\tilde{\varepsilon}
\end{align}
eingeführt.

Eingesetzt in die Gleichung des geregelten Fehlersystems \ref{eqn:fehlersystem_geregelt_ktilde}
ergibt sich:
\begin{align}
    \dot{\tilde{\varepsilon}} &=((T^H \otimes I_n)(I_N \otimes A)(T \otimes I_n) - (T^H \otimes I_n)(I_N \otimes B)\tilde{K}(H \otimes I_n)(T \otimes I_n)) \tilde{\varepsilon} \\
    &= (I_N \otimes A - H_\urcorner \otimes BK)\tilde{\varepsilon} \\
    &= \tilde{A}\tilde{\varepsilon} 
\end{align}
mit $H_\urcorner = T^H H T$.

Da die Diagonalelemente von $H_\urcorner$ gerade dessen Eigenwerte, und damit auch die
Eigenwerte von $H$ sind (Matrizen sind Ähnlich), lassen sich die Blockdiagonalelemente von
$\tilde{A}$ darstellen als:
\begin{equation}
    \tilde{A}_{ii} = A-\lambda(H)BK
\end{equation}

$K$ muss nun also so bestimmt werden, dass diese $N$ unterschiedlichen Matrizen simultan
zu Hurwitz-Matrizen ($\operatorname{Re}\lambda < 0)$ macht.
\todo[inline]{Fragestunde: Sind die Elemente oberhalb der Diagonalen relevant?}

Notwendige Bedingung dafür ist $\det H \neq 0$ (Siehe \ref{par:leader_follower_matrix}, das
kann man evtl am Graph sehen).
\todo[inline]{Bedingung nachvollziehen, Seite 4-18}

Der Riccati-Entwurf kann die simultane Stabilisierung in diesem fall immer lösen,
was das ganze zur hinreichenden Bedingung macht.

\subsection{Entwurf Netzwerkregler}
\todo[inline]{Das hier noch mal überarbeiten, nachdem es jetzt alles oberhalb gibt}
Ziel ist ein Netzwerkregler der Form
\begin{equation}
    u_i = -\sum_{j=1}^N a_{ij} (Kx_i - Kx_j) - a_{i0} (Kx_i - Kx_0)
\end{equation}
Die Rückführmatrix $K$ bestimmt sich durch
\begin{equation}
    K=c R^{-1} B^T P
\end{equation}
mit $P$ Lösung der algebraischen Riccati-Gleichung
\begin{equation}
    \tag{ARE}
    A^T P + P A - P B R^{-1} B^T P + Q = 0
\end{equation}
wobei $Q \in \mathbb{R}^{n\times n}$ und $R \in \mathbb{R}^{n\times n}$
positiv definit, mit $n$ Dimension des Zustandes und $p$ Dimension des
Inputs.

Für den Parameter $c$ muss gelten
\begin{equation}
    c \geq \frac{1}{2 \cdot \min_{i=1,\ldots,N} \operatorname{Re} \lambda_i(H)}
\end{equation}

\todo[inline]{Fertig machen (Blatt3)?}

\subsubsection{Sonderfall: Reduzible Kommunikationstopologie}
Wenn die Leader-Follower-Matrix als untere ($r\times r$) Blockdiagonalmatrix
dargestellt werden kann (evtl nach Ändern der Nummerierung der Agenten),
können $r$ unabhängige Stabilisierungsprobleme mit $r$ unterschiedlichen
Rückführmatrizen gelöst werden.

\subsubsection{Sonderfall: Kreisfreie Kommunikationstopologie}
Eine kreisfreie Topologie erlaubt umnummerierung sodass die
Leader-Follower-Matrix eine untere ($N\times N$) Dreiecksmatrix ist.

Dann können $N$ unterschiedliche Rückführmatrizen bestimmt werden.
\todo[inline]{Kreisfreie Kommunikationstopologie, Eigenwertvorgabe: Blatt 3f}

\subsection{Analyse Netzwerkregler}
\todo[inline]{Synchronisierungs-Eigenwerte: Blatt 3g}



\section{Leaderless Zustandssynchronisierung}
\paragraph{Folgefehlerdynamik}
Es gibt zwar keinen Führungsagenten, aber wir können einen Folgefehler
bezüglich eines ausgewählten Agentens ($x_1$) definieren.
Damit ergeben sich die \emph{Synchronisierungskoordinaten}:
\begin{equation}
    \tilde{x} = \begin{bmatrix}
        x_1 \\
        \varepsilon
    \end{bmatrix}
    = \begin{bmatrix}
        x_1 \\
        x_2 - x_1 \\
        \vdots \\
        x_N - x_1
    \end{bmatrix}
    = \left(\begin{bmatrix}
        1 & 0 \\
        -1_{N-1} & I_{N-1}
    \end{bmatrix}
    \otimes I_n
    \right) x
    = (\Theta \otimes I_n)x
\end{equation}
(Die Einträge $1$, $0$, und $-1_{N-1}$ in $\Theta$ sind hierbei als skalar bzw Zeilen- und Spaltenvektor zu verstehen.)

Aus der Systemdynamik
\begin{equation}
    \dot{x} = (I_N \otimes A) x + (I_N \otimes B)u
\end{equation}
folgt dann nach Transformation auf Synchronisierungskoordinaten die
\emph{Folgefehlerdynamik}:
\begin{equation}
    \dot{\tilde{x}} = (I_N \otimes A) \tilde{x} + (\Theta \otimes B)u
\end{equation}

\paragraph{Stellgesetz}

\todo[inline]{Nachvollziehen, vgl mit leader-follower}

\subsection{Entwurf Netzwerkregler}

\subsubsection{Bedingung}
Damit sich eine Rückführmatrix $K$ bestimmen lässt, muss gelten
\begin{equation}
    \operatorname{Re} \lambda_i(L_{22}) > 0
\end{equation}
bzw
\begin{equation}
    \det L_{22} \neq 0
\end{equation}
wobei $L_{22}$ folgt aus
\begin{equation}
    \Theta L_\mathcal{G} \Theta^{-1} = \begin{bmatrix}
        0 & \Theta L_\mathcal{G}M
    \end{bmatrix}
    = \begin{bmatrix}
        0 & l_{12}^T \\
        0_{N-1} & L_{22}
    \end{bmatrix}
\end{equation}

$\det L_{22} \neq 0$ folgt auch direkt daraus, dass der Graph zusammenhängend ist.

\section{Leaderless Ausgangssynchronisierung}
